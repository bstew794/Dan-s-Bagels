{% extends 'bagels/base.html' %}

{% block tab_title %} User Profile {% endblock %}
{% block page_title %}<h1>User Profile</h1>{% endblock %}

{% block content %}
    {% load string_to_list %}
    <h1>
        Welcome {{ user.username }}!
    </h1>

    <!-- Account Information -->
    <h2>
        View your account information here
    </h2>
    <h4><a href="{% url 'edit_profile' %}">Edit Profile</a></h4>
    <h4><a href="{% url 'change_password' %}">Change Password</a></h4>
    <hr>
    <h3>
        First Name:       {{ user.first_name }} <br>
        Last Name:        {{ user.last_name }} <br>
        Email:            {{ user.email }} <br>
        Phone Number:     {{ user.profile.phone_number }} <br>
        Member Number:    {{ user.profile.member_number }} <br>
        Account Balance:  ${{ user.profile.account_balance }} <br>
    </h3>

    <!-- Edit Account Information -->
    <h2>
        Edit account information here
    </h2>
    <hr>
    <h3>
        <form action="{% url 'edit' %}" method="post">
	    {% csrf_token %}
            Add Balance to your Account:
            <input type="number" name="add_balance" value="0">
            <br>
            <input type="submit" value="Submit Changes">
        </form>
    </h3>

    <!-- View Account Orders -->
    <h2>
        View your orders here
    </h2>
    <hr>
    {% for order in orders %}
        <div class="order">
            {% string_to_list order.items as item_list %}
            <h3>Order {{ order.id }} -- ${{ order.total_cost }} -- Pickup on {{ order.pickup_time }}</h3>
            <ul>
                {% for item in item_list %}
                    <li>{{ item }}</li>
                {% endfor %}
            </ul>
            {% if order.is_prepared %}
                <h6>PREPARED</h6>
            {% else %}
                <h6>PREPARING</h6>
            {% endif %}

            {% if not order.is_prepared and not order.is_fufilled %}
                <button onclick="location.href = '{% url 'remove_order' order.id %}'">Refund Order</button>
            {% else %}
                <button onclick="location.href = '{% url 'remove_order' order.id %}'">Remove Order</button>
            {% endif %}
            <br><br>

					</div>
        {% endfor %}
    </h3>

    <!-- Manager Information -->
    {% if perms.bagels.can_manage %}
    <h2>
        Manager info here
    </h2>
    <h3>
        <form action="{% url 'add_stock' %}" method="post">
            {% csrf_token %}
            {% for item in inventory %}
                {{ item }}
                <input type="number" name="{{ item.name }}" value="0">
                <br>
            {% endfor %}
            <input type="submit" value="Submit Changes">
        </form>
    </h3>
    {% endif %}
</body>

</html>
        </div>
{% endblock %}
